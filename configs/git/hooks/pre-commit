#!/bin/bash
# Pre-commit hook - Run before committing

set -e

echo "Running pre-commit checks..."

# Run go fmt
echo "  Formatting Go code..."
gofmt -l -w . 2>&1 | grep -v "vendor/" || true

# Run go vet
echo "  Running go vet..."
go vet ./... 2>&1 | grep -v "vendor/" || true

# Run golangci-lint
if command -v golangci-lint &> /dev/null; then
    echo "  Running golangci-lint..."
    golangci-lint run ./... --timeout=5m || {
        echo "❌ Linting failed. Fix issues before committing."
        exit 1
    }
fi

# Run tests (fast ones only)
echo "  Running unit tests..."
go test -short ./... || {
    echo "❌ Tests failed. Fix tests before committing."
    exit 1
}

echo "✅ Pre-commit checks passed!"
