db.createCollection("tenant_app_configs", {
   validator: {
      $jsonSchema: {
         bsonType: "object",
         required: ["_id", "tenant_id", "app_code", "configs", "version", "created_at", "updated_at"],
         properties: {
            _id: { bsonType: "string", description: "Must be a UUID v7 string" },
            tenant_id: { bsonType: "string", description: "Must be a UUID string of the tenant" },
            app_code: { bsonType: "string", description: "App code identifier (e.g., HRM, CRM)" },
            configs: { bsonType: "object", description: "Flexible configuration object" },
            version: { bsonType: "long", minimum: 1 },
            created_at: { bsonType: "date" },
            updated_at: { bsonType: "date" }
         }
      }
   }
});
Câu lệnh tạo Index (Chỉ mục)
Các chỉ mục này giúp tối ưu hóa việc tra cứu cấu hình cho từng ứng dụng của từng khách hàng và hỗ trợ quá trình đồng bộ dữ liệu (CDC),.
// 1. Index duy nhất: Đảm bảo một Tenant chỉ có một bộ cấu hình cho mỗi App
db.tenant_app_configs.createIndex(
    { "tenant_id": 1, "app_code": 1 },
    { unique: true, name: "idx_tenant_app_unique" }
);

// 2. Index cho Sharding: Tối ưu hóa việc phân tán dữ liệu theo khách hàng
// Thường sử dụng tenant_id làm Shard Key trong kiến trúc SaaS
db.tenant_app_configs.createIndex({ "tenant_id": 1 });

// 3. Index hỗ trợ CDC/Sync: Tìm kiếm các bản ghi mới cập nhật để đẩy sang ClickHouse
db.tenant_app_configs.createIndex({ "updated_at": -1 });

// 4. Index hỗ trợ tìm kiếm sâu trong JSON (GIN Index tương đương trong Mongo)
// Ví dụ: Tìm các tenant đang cấu hình theme_color là 'blue'
db.tenant_app_configs.createIndex({ "configs.theme_color": 1 }, { sparse: true });


